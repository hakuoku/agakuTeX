+++
description = ""
date = "2017-04-19T13:03:39+09:00"
title = "ファイル作成とエスケープ"
topics = ["拡張子の設定", "エラー", "インラインコマンドの書き方", "verb", "検索・置換"]
slug = "escape"
weight = 330
[menu.toc]
    parent = "generate"
+++
&#x3000;いよいよ本チャンの原稿作りに入ります。TeX文法と機能を一つずつ組んで一喜一憂しながら解説します。

　まずは新しくファイルを作り、テストと同じように、最低限の4行を書いてやります。ここでは「chapter01」と名前をつけ（好きな名前でOK。ただしスペースは避け半角英数のみにする）、拡張子を.texにしてUTF-8で保存します。

　あるいは既存の原稿に上書きすることもできます。その場合「ここに～」のところに小説本文が来るように書き込んでください（ただし長編全部は扱いづらいので、長い話はひとまずキリのいいところまでカットするのが吉）。  
　実は拡張子は.txtのままでもTeXWorksに通せます。なのでファイルの保存方式を変えたくない人や、原稿がまだ未完成でこれからも加筆するだろうという人は上書き方式の方がいいと思います。特にスマホで編集したい場合は、texファイルは読み込めないことが多いので.txtのままにしておきましょう。あとは組版だけとなった決定稿の時点で.texにするのが無難かと思います。

```latex
\documentclass{article}
\begin{document}
ここに本文が来ます
\end{document}
```

　基本的にTeXは、**`\`** （バックスラッシュ。環境によって円マークに見えたり斜め線に見えたりしますが同じものです）を頭につけた**コマンド**という文字列で指示をします。\指示の種類{指示の中身}って感じです。  
　`\begin`と`\end`は「これこれこういうフィールドが始まります／終わります」という宣言です。この場合は**document**という一番基本のフィールドをこしらえています。これがないとTeX文書になりません。字が植え込まれるこのフィールドのことを「**環境**」と呼びます。「版面」だと思っちゃってもいいです。

　青空文庫の人も同様、新しいtexファイルに本文を入れ込むか元のファイルにコマンドを書きこんで、beginとendで本文を挟みます。原理的にはもうそれで組版できるはずなんですが、私はこんなエラーが出ました。

    ! You can't use `macro parameter character #' in horizontal mode.
    l.89 ...なので、五番目のポオルは fa#
    だというわけ。そこ
    ?

　どういうことかというと、「ノンシャラン道中記」の本文に、TeXで使っちゃいけない#の字が入っているんですね。ちなみにオルガンごっこをするというシーンで、ファのシャープです。  
　こういう「TeX側がコマンドとして使うから人間は使っちゃいけない記号」はけっこうあって、選んだテキストによっては文字は違えどこれと同じエラーが出るかもしれません。そのため**エスケープ**というものをして、特殊文字が表示されるようにします。  
　使い方は簡単で、特殊文字の前にバックスラッシュをつけるだけです。その方式じゃない字もありますが、その場合は以下の表を参考に正しいコマンドに置き換えます。ちなみに全て半角です。全角文字は全て字として描画されるので、違和感がなければただ全角に置き換えるのでもいいと思います。

|記号|TeXにとっての働き|置き換え|
|:--:|:---------|:------|
| # | 命令や環境の引数 | `\#` |
| $ | 数式モードへ移行 | `\$` |
| % | 以降をコメントアウト | `\%` |
| & | 表のセルの区切り | `\&` |
| _ | 下付きの添字 | `\_` |
| { | グループ化の開始 | `\{` |
| } | グループ化の終了 | `\}` |
| &lt; | （モードにより出力が異なる ）| `\textless` または \verb\|<\| |
| &gt; | （同上） | `\textgreater` または \verb\|>\| |
| \\ | コマンドのためのエスケープ文字 | `\textbackslash` |
| \| | 表の縦の罫線 | `\textbar` |
| ^ | 上付きの添字 | `\textasciicircum` |
| ~ | 改行を抑制して単語間の空白を空ける| `\textasciitilde` |

　\textなんちゃらというのも、「なんちゃらという文字を出力せよ」という一種のコマンドになります。バックスラッシュの後が記号だけのコマンドはいいんですが、アルファベットが続くコマンドは`ポオルは\textlessfa\textgreaterと`というように、本文とそのまま続けて書くことはできません（「\textlessfa」という文字列だと認識されてしまう）。  
　本文との間に半角スペースを空けるか、`{\textless}fa`のようにコマンドを中括弧で囲みます。半角スペースを入れるとぴったりくっつけて出力したい記号と本文の間に空白ができてしまう場合があるので、随時括弧と使い分けて下さい。

　`\verb`というのはverbatim［逐語的に／一字一句変えずに］の略で、記号で挟んだ部分（縦棒じゃなくてもいい。`\verb!fa#!`とかでもいい）を文字通り出力できるコマンドです。これは本文とくっつけて書いても大丈夫です。  
　じゃあ全部それの内側に書けばいいじゃんって話になるかもしれませんが、それをやってしまうと今度は逆に組版に支障が出るので控えます。小説ではさほど多用することにはならないと思いますが、URLなど特殊文字があまりにたくさん出てくる箇所に使うといいでしょう。

　ちなみにエスケープ文字に限らずエラーが出た時は、停止ボタンを押すと下のコンソールエリアに「errors, warnings, badboxes」タブが現れます。中のリンクを押すと上のエディタで該当箇所に飛びますので、これを使ってチェックしてください。エラー文のGoogle検索も役に立ちます。  
　修正しても組版結果が思ったようなデザインにならないかもしれませんが、こうした記号の細かい出力制御は後ほど行います。今はひとまずエラーが出ないところまで置き換えればOKとしておきましょう。  

{{< figure src="/img/33makefile/errortab.png" caption="" alt="エラータブ" class="" >}}

　多すぎて手で書き換えられないという時は、エディタの**検索・置換機能**を使うと一括で編集することができます。  
　まず本文のところのみを範囲選択します。次に置換ウィンドウを開き、「 _選択した範囲のみ_ 」と「 _正規表現を使用_ 」のところにチェックを入れます（これをやらないとコマンドのところまで認識されて大変なことになる）。  
　そうしたら以下の表を**上から順に**1段ずつコピペして、「すべて置換」してください。

<table>
<thead>
<tr>
<th align="left">検索する文字列</th>
<th align="left">置換後の文字列</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>&#092;&#092;</code></td>
<td align="center"><code>{&#092;&#092;textbackslash}</code></td>
</tr>
<tr>
<td align="center"><code>([&#35;&#36;&#37;&amp;&#95;&#123;&#125;])</code></td>
<td align="center"><code>&#092;&#092;$1</code></td>
</tr>
<tr>
<td align="center"><code>&#092;|</code></td>
<td align="center"><code>{&#092;&#092;textbar}</code></td>
</tr>
<tr>
<td align="center"><code>&#092;&lt;</code></td>
<td align="center"><code>&#092;&#092;verb|&lt;|</code></td>
</tr>
<tr>
<td align="center"><code>&#092;&gt;</code></td>
<td align="center"><code>&#092;&#092;verb|&gt;|</code></td>
</tr>
<tr>
<td align="center"><code>&#092;&#94;</code></td>
<td align="center"><code>{&#092;&#092;textasciicircum}</code></td>
</tr>
<tr>
<td align="center"><code>~</code></td>
<td align="center"><code>{&#092;&#092;textasciitilde}</code></td>
</tr>
<tr>
<td align="center"><code>&#092;&#092;{&#092;&#092;textbackslash&#092;&#092;}</code></td>
<td align="center"><code>{&#092;&#092;textbackslash}</code></td>
</tr>
</tbody>
</table>

　さて#を`\#`にしてやって、TeXWorksで開いてボタンを押すと、

{{< figure src="/img/33makefile/first.png" caption="" alt="最初の組版結果" class="" >}}

　無事に組版できました。だいぶごちゃごちゃしてますが、これからちゃんとした本になっていきますよ。

#### 参考

- https://texwiki.texjp.org/?TeX%20%E3%81%AE%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8#cf1b15c8
- [Tex tips - ６．特殊文字](http://osksn2.hep.sci.osaka-u.ac.jp/~naga/miscellaneous/tex/tex-tips6.html)
- [LaTeXコマンド - そのまま出力できる文字と特殊文字](https://medemanabu.net/latex/special-character/)
- [LaTeXコマンド - テキストを入力通りにそのまま出力（verb、verbatim)](https://medemanabu.net/latex/verb-verbatim/)

